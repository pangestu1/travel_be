// Prisma Generator
generator client {
  provider = "prisma-client-js"
}

// MySQL Database
datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// =============================================
// USER MODEL - Internal system users (Admin, Sales, CS, Manager)
// =============================================
model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  password  String
  role      Role     @default(SALES)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  interactions Interaction[] // CS can log interactions

  @@map("users")
}

enum Role {
  ADMIN
  SALES
  CS
  MANAGER
}

// =============================================
// CUSTOMER MODEL - Travel customers
// =============================================
model Customer {
  id        Int            @id @default(autoincrement())
  name      String
  email     String         @unique
  password  String         @default("$2b$10$EpRnTzVlqHNP0zQx.Z.WeO.z5/z.Z.WeO.z5/z.Z.WeO.z5/z") // Default: "password123" (hashed)
  phone     String?
  address   String?
  status    CustomerStatus @default(PROSPECT)
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt

  // Relations
  bookings     Booking[]
  interactions Interaction[]

  @@map("customers")
}

enum CustomerStatus {
  PROSPECT // New lead, not yet booked
  ACTIVE   // Has active booking
  LOYAL    // Repeat customer
}

// =============================================
// TRAVEL PACKAGE MODEL
// =============================================
model TravelPackage {
  id          Int       @id @default(autoincrement())
  name        String
  destination String
  description String?   @db.Text
  price       Decimal   @db.Decimal(12, 2)
  quota       Int       // Max participants
  startDate   DateTime
  endDate     DateTime
  isActive    Boolean   @default(true)
  imageUrl    String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  bookings Booking[]

  @@map("travel_packages")
}

// =============================================
// BOOKING MODEL
// =============================================
model Booking {
  id             Int           @id @default(autoincrement())
  bookingCode    String        @unique @default(cuid())
  customerId     Int
  packageId      Int
  participants   Int           @default(1)
  totalAmount    Decimal       @db.Decimal(12, 2)
  departureDate  DateTime
  status         BookingStatus @default(PENDING)
  notes          String?       @db.Text
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  // Relations
  customer Customer      @relation(fields: [customerId], references: [id])
  package  TravelPackage @relation(fields: [packageId], references: [id])
  payment  Payment?

  @@map("bookings")
}

enum BookingStatus {
  PENDING   // Awaiting payment
  PAID      // Payment completed
  CONFIRMED // Booking confirmed by admin
  CANCELED  // Booking canceled
  COMPLETED // Trip completed
}

// =============================================
// PAYMENT MODEL - Midtrans integration
// =============================================
model Payment {
  id              Int           @id @default(autoincrement())
  bookingId       Int           @unique
  midtransOrderId String        @unique
  midtransToken   String?       @db.Text
  paymentUrl      String?       @db.Text
  amount          Decimal       @db.Decimal(12, 2)
  status          PaymentStatus @default(PENDING)
  paymentType     String?
  paidAt          DateTime?
  expiredAt       DateTime?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  // Relations
  booking Booking @relation(fields: [bookingId], references: [id])

  @@map("payments")
}

enum PaymentStatus {
  PENDING
  SUCCESS
  FAILED
  EXPIRED
  REFUND
}

// =============================================
// INTERACTION MODEL - Customer service logs
// =============================================
model Interaction {
  id           Int             @id @default(autoincrement())
  customerId   Int
  userId       Int // CS user who logged the interaction
  type         InteractionType
  notes        String?         @db.Text
  followUpDate DateTime?
  isResolved   Boolean         @default(false)
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt

  // Relations
  customer Customer @relation(fields: [customerId], references: [id])
  user     User     @relation(fields: [userId], references: [id])

  @@map("interactions")
}

enum InteractionType {
  CALL
  EMAIL
  WHATSAPP
  COMPLAINT
  FOLLOW_UP
  OTHER
}
